<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create Quiz</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.1.3/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .create-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 2rem;
            border-radius: 10px;
            margin-bottom: 2rem;
        }
        .question-section {
            border: 2px solid #e9ecef;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            background: #f8f9fa;
        }
        .option-input {
            margin-bottom: 10px;
        }
        .correct-option {
            border-left: 4px solid #28a745;
            background-color: #d4edda;
        }
        .btn-add-option {
            background: linear-gradient(45deg, #28a745, #20c997);
            border: none;
        }
        .btn-add-question {
            background: linear-gradient(45deg, #007bff, #6610f2);
            border: none;
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container">
            <a class="navbar-brand" href="/dashboard">Quiz App</a>
            <div class="navbar-nav ms-auto">
                <a class="btn btn-outline-light btn-sm" href="/dashboard">Back to Dashboard</a>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <div class="create-header text-center">
            <h1>Create New Quiz</h1>
            <p class="mb-0">Design your quiz with questions and multiple choice answers</p>
        </div>

        <!-- Flash Messages -->
        <div th:if="${success}" class="alert alert-success alert-dismissible fade show" role="alert">
            <span th:text="${success}"></span>
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
        <div th:if="${error}" class="alert alert-danger alert-dismissible fade show" role="alert">
            <span th:text="${error}"></span>
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>

        <form action="/create" method="post" id="quizForm">
            <!-- Quiz Title -->
            <div class="card mb-4">
                <div class="card-header">
                    <h5>Quiz Information</h5>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <label for="title" class="form-label">Quiz Title *</label>
                        <input type="text" class="form-control" id="title" name="title" 
                               placeholder="Enter quiz title" required>
                    </div>
                </div>
            </div>

            <!-- Questions Container -->
            <div id="questionsContainer">
                <!-- Initial Question -->
                <div class="question-section" data-question="1">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h5>Question 1</h5>
                        <button type="button" class="btn btn-danger btn-sm" onclick="removeQuestion(this)">
                            Remove Question
                        </button>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">Question Text *</label>
                        <textarea class="form-control" name="questions[1].text" 
                                  placeholder="Enter your question" required rows="3"></textarea>
                    </div>

                    <div class="options-container">
                        <label class="form-label">Answer Options * (Select the correct answer)</label>
                        <div class="option-input">
                            <div class="input-group">
                                <div class="input-group-text">
                                    <input type="radio" name="questions[1].correct" 
                                           value="" class="correct-radio" required>
                                </div>
                                <input type="text" class="form-control option-text" 
                                       name="questions[1].options[1]" 
                                       placeholder="Option 1" required>
                                <button type="button" class="btn btn-outline-danger" 
                                        onclick="removeOption(this)">×</button>
                            </div>
                        </div>
                        <div class="option-input">
                            <div class="input-group">
                                <div class="input-group-text">
                                    <input type="radio" name="questions[1].correct" 
                                           value="" class="correct-radio" required>
                                </div>
                                <input type="text" class="form-control option-text" 
                                       name="questions[1].options[2]" 
                                       placeholder="Option 2" required>
                                <button type="button" class="btn btn-outline-danger" 
                                        onclick="removeOption(this)">×</button>
                            </div>
                        </div>
                    </div>

                    <button type="button" class="btn btn-add-option btn-sm mt-2" 
                            onclick="addOption(this)">
                        + Add Option
                    </button>
                </div>
            </div>

            <!-- Add Question Button -->
            <div class="text-center mb-4">
                <button type="button" class="btn btn-add-question" onclick="addQuestion()">
                    + Add Question
                </button>
            </div>

            <!-- Submit Button -->
            <div class="text-center mb-5">
                <button type="submit" class="btn btn-success btn-lg px-5">
                    Create Quiz
                </button>
            </div>
        </form>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.1.3/js/bootstrap.bundle.min.js"></script>
    <script>
        let questionCount = 1;

        function addQuestion() {
            questionCount++;
            const container = document.getElementById('questionsContainer');
            
            const questionHtml = `
                <div class="question-section" data-question="${questionCount}">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h5>Question ${questionCount}</h5>
                        <button type="button" class="btn btn-danger btn-sm" onclick="removeQuestion(this)">
                            Remove Question
                        </button>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">Question Text *</label>
                        <textarea class="form-control" name="questions[${questionCount}].text" 
                                  placeholder="Enter your question" required rows="3"></textarea>
                    </div>

                    <div class="options-container">
                        <label class="form-label">Answer Options * (Select the correct answer)</label>
                        <div class="option-input">
                            <div class="input-group">
                                <div class="input-group-text">
                                    <input type="radio" name="questions[${questionCount}].correct" 
                                           value="" class="correct-radio" required>
                                </div>
                                <input type="text" class="form-control option-text" 
                                       name="questions[${questionCount}].options[1]" 
                                       placeholder="Option 1" required>
                                <button type="button" class="btn btn-outline-danger" 
                                        onclick="removeOption(this)">×</button>
                            </div>
                        </div>
                        <div class="option-input">
                            <div class="input-group">
                                <div class="input-group-text">
                                    <input type="radio" name="questions[${questionCount}].correct" 
                                           value="" class="correct-radio" required>
                                </div>
                                <input type="text" class="form-control option-text" 
                                       name="questions[${questionCount}].options[2]" 
                                       placeholder="Option 2" required>
                                <button type="button" class="btn btn-outline-danger" 
                                        onclick="removeOption(this)">×</button>
                            </div>
                        </div>
                    </div>

                    <button type="button" class="btn btn-add-option btn-sm mt-2" 
                            onclick="addOption(this)">
                        + Add Option
                    </button>
                </div>
            `;
            
            container.insertAdjacentHTML('beforeend', questionHtml);
        }

        function removeQuestion(button) {
            const questionSection = button.closest('.question-section');
            if (document.querySelectorAll('.question-section').length > 1) {
                questionSection.remove();
                updateQuestionNumbers();
            } else {
                alert('At least one question is required!');
            }
        }

        function addOption(button) {
            const questionSection = button.closest('.question-section');
            const questionNum = questionSection.getAttribute('data-question');
            const optionsContainer = questionSection.querySelector('.options-container');
            const optionCount = optionsContainer.querySelectorAll('.option-input').length + 1;
            
            const optionHtml = `
                <div class="option-input">
                    <div class="input-group">
                        <div class="input-group-text">
                            <input type="radio" name="questions[${questionNum}].correct" 
                                   value="" class="correct-radio" required>
                        </div>
                        <input type="text" class="form-control option-text" 
                               name="questions[${questionNum}].options[${optionCount}]" 
                               placeholder="Option ${optionCount}" required>
                        <button type="button" class="btn btn-outline-danger" 
                                onclick="removeOption(this)">×</button>
                    </div>
                </div>
            `;
            
            button.insertAdjacentHTML('beforebegin', optionHtml);
        }

        function removeOption(button) {
            const optionInput = button.closest('.option-input');
            const optionsContainer = optionInput.closest('.options-container');
            
            if (optionsContainer.querySelectorAll('.option-input').length > 2) {
                optionInput.remove();
            } else {
                alert('At least two options are required per question!');
            }
        }

        function updateQuestionNumbers() {
            const questions = document.querySelectorAll('.question-section');
            questions.forEach((question, index) => {
                const newNum = index + 1;
                question.setAttribute('data-question', newNum);
                question.querySelector('h5').textContent = `Question ${newNum}`;
                
                // Update form field names
                const textarea = question.querySelector('textarea');
                textarea.name = `questions[${newNum}].text`;
                
                const radios = question.querySelectorAll('.correct-radio');
                radios.forEach(radio => {
                    radio.name = `questions[${newNum}].correct`;
                });
                
                const optionInputs = question.querySelectorAll('.option-text');
                optionInputs.forEach((input, optionIndex) => {
                    input.name = `questions[${newNum}].options[${optionIndex + 1}]`;
                    input.placeholder = `Option ${optionIndex + 1}`;
                });
            });
        }

        // Update radio button values when option text changes
        document.addEventListener('input', function(e) {
            if (e.target.classList.contains('option-text')) {
                const radio = e.target.closest('.input-group').querySelector('.correct-radio');
                radio.value = e.target.value;
            }
        });

        // Form validation
        document.getElementById('quizForm').addEventListener('submit', function(e) {
            const questions = document.querySelectorAll('.question-section');
            let valid = true;
            
            questions.forEach(question => {
                const radios = question.querySelectorAll('.correct-radio');
                const hasChecked = Array.from(radios).some(radio => radio.checked);
                
                if (!hasChecked) {
                    valid = false;
                    question.style.border = '2px solid #dc3545';
                    setTimeout(() => {
                        question.style.border = '2px solid #e9ecef';
                    }, 3000);
                }
            });
            
            if (!valid) {
                e.preventDefault();
                alert('Please select the correct answer for each question!');
            }
        });
    </script>
</body>
</html>